/**
 * KnUpload v5.0.0 (2023-12-16 12:50:37 +0100)
 * Copyright (c) 2019-2023 Florent VIALATTE
 * Released under the MIT license
 */
'use strict';const KnUpload={VERSION:'5.0.0'};Element.prototype.KnUpload=function(e){let n=this,o=n.querySelector('input[type=file]'),t=0,r=!1,a=null;if(e||(e={}),!e.url)throw'URL is mandatory';function l(e){r&&(e.stopPropagation(),e.preventDefault())}function s(e){r||e.target&&e.target.files&&e.target.files.length&&(f(e.target.files),this.value='')}function i(n){n.stopPropagation(),n.preventDefault(),r||(t>0&&(t=0,e.onDragLeave&&e.onDragLeave.call()),n.dataTransfer&&n.dataTransfer.files&&n.dataTransfer.files.length&&f(n.dataTransfer.files))}function d(n){n.stopPropagation(),n.preventDefault(),r||(e.onDragEnter&&0==t&&e.onDragEnter.call(),t++)}function u(e){e.stopPropagation(),e.preventDefault()}function c(n){n.stopPropagation(),n.preventDefault(),r||(t--,e.onDragLeave&&0==t&&e.onDragLeave.call())}function p(e){return e.stopPropagation(),e.preventDefault(),!1}function f(n){if(r=!0,e.onNewFiles&&e.onNewFiles.call(this,n),n.length>e.maxFiles)return e.onTooManyFiles&&e.onTooManyFiles.call(),void(r=!1);const o=[];let t=0;for(const a in n)if('object'==typeof n[a]){if(t+=n[a].size,n[a].size>e.maxFilesSize||t>e.maxFilesSize)return e.onFileSizeError&&e.onFileSizeError.call(),void(r=!1);o.push(n[a])}e.onBeforeUpload&&e.onBeforeUpload.call();const a=[];for(const n in o){const t=new FileReader;t.onload=e=>{a.push({name:o[n].name,content:new Blob([e.target.result])}),a.length==o.length&&r&&v(a)},t.onerror=n=>{e.onUploadError&&e.onUploadError.call(this,n),r=!1},t.readAsArrayBuffer(o[n])}}function v(n){null!=a&&a.abort(),e.onUploadProgress&&e.onUploadProgress.call(this,0);let o=new FormData;o.append('nb_files',n.length),n.forEach(((e,n)=>{o.append('file_'+n,e.content),o.append('file_'+n+'_name',e.name)}));for(const[n,t]of Object.entries('function'==typeof e.data?e.data():e.data))o.append(n,'function'==typeof t?t():t);for(const[n,o]of Object.entries(e.headers))e.headers[n]='function'==typeof o?o():o;a=KnHttp.postRaw('function'==typeof e.url?e.url():e.url,o,{upload:!0,timeout:e.timeout,responseType:e.responseType,headers:e.headers,csrf:e.csrf,csrfHeader:e.csrfHeader,withCredentials:e.withCredentials,basicAuth:e.basicAuth,bearerAuthToken:e.bearerAuthToken}).onProgress((n=>{-1!=n&&(e.onUploadProgress&&e.onUploadProgress.call(this,n),n>=100&&e.onUploadComplete&&e.onUploadComplete.call())})).onSuccess(((n,o)=>{e.onUploadSuccess&&e.onUploadSuccess.call(this,n,o)})).onError(((n,o)=>{n!=KnHttp.CANCELED_ERROR&&e.onUploadError&&e.onUploadError.call(this,n,o)})).onEnd((()=>{e.onAjaxComplete&&e.onAjaxComplete.call(),r=!1}))}return e.data||(e.data={}),e.responseType||(e.responseType=null),e.headers||(e.headers={}),e.csrf||(e.csrf=null),e.csrfHeader||(e.csrfHeader=null),e.withCredentials||(e.withCredentials=null),e.basicAuth||(e.basicAuth=null),e.bearerAuthToken||(e.bearerAuthToken=null),e.maxFiles||(e.maxFiles=1),e.timeout||(e.timeout=0),e.maxFilesSize||(e.maxFilesSize=20971520),e.killDocumentDad||(e.killDocumentDad=!1),e.onDragEnter||(e.onDragEnter=null),e.onDragLeave||(e.onDragLeave=null),e.onNewFiles||(e.onNewFiles=null),e.onFileSizeError||(e.onFileSizeError=null),e.onTooManyFiles||(e.onTooManyFiles=null),e.onBeforeUpload||(e.onBeforeUpload=null),e.onUploadProgress||(e.onUploadProgress=null),e.onUploadComplete||(e.onUploadComplete=null),e.onUploadSuccess||(e.onUploadSuccess=null),e.onUploadError||(e.onUploadError=null),e.onAjaxComplete||(e.onAjaxComplete=null),e.maxFiles>1?o.setAttribute('multiple',''):o.removeAttribute('multiple'),n.addEventListener('click',l),o.addEventListener('change',s),n.addEventListener('drop',i),n.addEventListener('dragenter',d),n.addEventListener('dragover',u),n.addEventListener('dragleave',c),e.killDocumentDad&&(document.addEventListener('drag',p),document.addEventListener('dragstart',p),document.addEventListener('dragend',p),document.addEventListener('dragenter',p),document.addEventListener('dragover',p),document.addEventListener('dragleave',p),document.addEventListener('drop',p)),{opt:e,uploadInProgress:r,cancel:function(){r=!1,null!=a&&a.abort()},destroy:function(){n.removeEventListener('click',l),o.removeEventListener('change',s),n.removeEventListener('drop',i),n.removeEventListener('dragenter',d),n.removeEventListener('dragover',u),n.removeEventListener('dragleave',c),e.killDocumentDad&&(document.removeEventListener('drag',p),document.removeEventListener('dragstart',p),document.removeEventListener('dragend',p),document.removeEventListener('dragenter',p),document.removeEventListener('dragover',p),document.removeEventListener('dragleave',p),document.removeEventListener('drop',p)),null!=a&&a.abort()}}};
