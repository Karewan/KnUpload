/**
 * KnUpload v3.0.1 (2022-10-21 14:04:36 +0200)
 * Copyright (c) 2019-2022 Florent VIALATTE
 * Released under the MIT license
 */
'use strict';const KnUpload={VERSION:'3.0.1'};Element.prototype.KnUpload=function(e){let n,o=this,t=o.querySelector('input[type=file]'),r=0,a=!1;if(e||(e={}),!e.url)throw'URL is mandatory';function l(e){a&&(e.stopPropagation(),e.preventDefault())}function d(e){a||e.target&&e.target.files&&e.target.files.length&&(f(e.target.files),this.value='')}function i(n){n.stopPropagation(),n.preventDefault(),a||(r>0&&(r=0,e.onDragLeave&&e.onDragLeave.call()),n.dataTransfer&&n.dataTransfer.files&&n.dataTransfer.files.length&&f(n.dataTransfer.files))}function s(n){n.stopPropagation(),n.preventDefault(),a||(e.onDragEnter&&0==r&&e.onDragEnter.call(),r++)}function p(e){e.stopPropagation(),e.preventDefault()}function u(n){n.stopPropagation(),n.preventDefault(),a||(r--,e.onDragLeave&&0==r&&e.onDragLeave.call())}function c(e){return e.stopPropagation(),e.preventDefault(),!1}function f(n){if(a=!0,e.onNewFiles&&e.onNewFiles.call(this,n),n.length>e.max_files)return e.onTooManyFiles&&e.onTooManyFiles.call(),void(a=!1);const o=[];let t=0;for(const r in n)if('object'==typeof n[r]){if(t+=n[r].size,n[r].size>e.max_files_size||t>e.max_files_size)return e.onFileSizeError&&e.onFileSizeError.call(),void(a=!1);o.push(n[r])}e.onBeforeUpload&&e.onBeforeUpload.call();const r=[];for(const n in o){const t=new FileReader;t.onload=e=>{r.push({name:o[n].name,content:new Blob([e.target.result])}),r.length==o.length&&a&&v(r)},t.onerror=n=>{e.onUploadError&&e.onUploadError.call(this,n),a=!1},t.readAsArrayBuffer(o[n])}}function m(){null!=n&&(n.abort(),n=null)}function v(o){e.onUploadProgress&&e.onUploadProgress.call(this,0);let t=new FormData;t.append('nb_files',o.length),o.forEach(((e,n)=>{t.append('file_'+n,e.content),t.append('file_'+n+'_name',e.name)}));for(const[n,o]of Object.entries(e.data))t.append(n,'function'==typeof o?o():o);for(const[n,o]of Object.entries(e.headers))e.headers[n]='function'==typeof o?o():o;e.headers['Content-Type']='multipart/form-data',axios.post(e.url,t,{timeout:e.timeout,headers:e.headers,onUploadProgress:g,signal:(m(),n=new AbortController,n.signal)}).then((n=>{e.onUploadSuccess&&e.onUploadSuccess.call(this,n)})).catch((n=>{n.__CANCEL__||e.onUploadError&&e.onUploadError.call(this,n)})).then((()=>{e.onAjaxComplete&&e.onAjaxComplete.call(),a=!1}))}function g(n){if(void 0===n||!n.lengthComputable)return;let o=Math.floor(100*n.loaded/n.total);e.onUploadProgress&&e.onUploadProgress.call(this,o),o>=100&&e.onUploadComplete&&e.onUploadComplete.call()}return e.data||(e.data={}),e.headers||(e.headers={}),e.max_files||(e.max_files=1),e.timeout||(e.timeout=0),e.max_files_size||(e.max_files_size=20971520),e.kill_document_dad||(e.kill_document_dad=!1),e.onDragEnter||(e.onDragEnter=null),e.onDragLeave||(e.onDragLeave=null),e.onNewFiles||(e.onNewFiles=null),e.onFileSizeError||(e.onFileSizeError=null),e.onTooManyFiles||(e.onTooManyFiles=null),e.onBeforeUpload||(e.onBeforeUpload=null),e.onUploadProgress||(e.onUploadProgress=null),e.onUploadComplete||(e.onUploadComplete=null),e.onUploadSuccess||(e.onUploadSuccess=null),e.onUploadError||(e.onUploadError=null),e.onAjaxComplete||(e.onAjaxComplete=null),e.max_files>1?t.setAttribute('multiple',''):t.removeAttribute('multiple'),o.addEventListener('click',l),t.addEventListener('change',d),o.addEventListener('drop',i),o.addEventListener('dragenter',s),o.addEventListener('dragover',p),o.addEventListener('dragleave',u),e.kill_document_dad&&(document.addEventListener('drag',c),document.addEventListener('dragstart',c),document.addEventListener('dragend',c),document.addEventListener('dragenter',c),document.addEventListener('dragover',c),document.addEventListener('dragleave',c),document.addEventListener('drop',c)),{opt:e,upload_in_progress:a,cancel:function(){a=!1,m()},destroy:function(){o.removeEventListener('click',l),t.removeEventListener('change',d),o.removeEventListener('drop',i),o.removeEventListener('dragenter',s),o.removeEventListener('dragover',p),o.removeEventListener('dragleave',u),e.kill_document_dad&&(document.removeEventListener('drag',c),document.removeEventListener('dragstart',c),document.removeEventListener('dragend',c),document.removeEventListener('dragenter',c),document.removeEventListener('dragover',c),document.removeEventListener('dragleave',c),document.removeEventListener('drop',c)),m()}}};
