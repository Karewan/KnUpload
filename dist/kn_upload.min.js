/**
 * KnUpload v3.0.0 (2022-06-19 13:36:43 +0200)
 * Copyright (c) 2019-2022 Florent VIALATTE
 * Released under the MIT license
 */
'use strict';const KnUpload={VERSION:'3.0.0'};Element.prototype.KnUpload=function(e){const n='kn_upload_acm';let o,t=this,r=t.querySelector('input[type=file]'),a=0,l=!1;if(e||(e={}),!e.url)throw'URL is mandatory';function d(e){l&&(e.stopPropagation(),e.preventDefault())}function s(e){l||e.target&&e.target.files&&e.target.files.length&&(m(e.target.files),this.value='')}function i(n){n.stopPropagation(),n.preventDefault(),l||(a>0&&(a=0,e.onDragLeave&&e.onDragLeave.call()),n.dataTransfer&&n.dataTransfer.files&&n.dataTransfer.files.length&&m(n.dataTransfer.files))}function c(n){n.stopPropagation(),n.preventDefault(),l||(e.onDragEnter&&0==a&&e.onDragEnter.call(),a++)}function u(e){e.stopPropagation(),e.preventDefault()}function p(n){n.stopPropagation(),n.preventDefault(),l||(a--,e.onDragLeave&&0==a&&e.onDragLeave.call())}function f(e){return e.stopPropagation(),e.preventDefault(),!1}function m(n){if(l=!0,e.onNewFiles&&e.onNewFiles.call(this,n),n.length>e.max_files)return e.onTooManyFiles&&e.onTooManyFiles.call(),void(l=!1);const o=[];let t=0;for(const r in n)if('object'==typeof n[r]){if(t+=n[r].size,n[r].size>e.max_files_size||t>e.max_files_size)return e.onFileSizeError&&e.onFileSizeError.call(),void(l=!1);o.push(n[r])}e.onBeforeUpload&&e.onBeforeUpload.call();const r=[];for(const n in o){const t=new FileReader;t.onload=e=>{r.push({name:o[n].name,content:new Blob([e.target.result])}),r.length==o.length&&l&&g(r)},t.onerror=n=>{e.onUploadError&&e.onUploadError.call(this,n),l=!1},t.readAsArrayBuffer(o[n])}}function v(){null!=o&&(o.cancel(n),o=null)}function g(t){e.onUploadProgress&&e.onUploadProgress.call(this,0);let r=new FormData;r.append('nb_files',t.length),t.forEach(((e,n)=>{r.append('file_'+n,e.content),r.append('file_'+n+'_name',e.name)}));for(const[n,o]of Object.entries(e.data))r.append(n,'function'==typeof o?o():o);for(const[n,o]of Object.entries(e.headers))e.headers[n]='function'==typeof o?o():o;e.headers['Content-Type']='multipart/form-data',axios.post(e.url,r,{timeout:e.timeout,headers:e.headers,onUploadProgress:E,cancelToken:(v(),o=axios.CancelToken.source(),o.token)}).then((n=>{e.onUploadSuccess&&e.onUploadSuccess.call(this,n)})).catch((o=>{o.message&&o.message==n||e.onUploadError&&e.onUploadError.call(this,o)})).then((()=>{e.onAjaxComplete&&e.onAjaxComplete.call(),l=!1}))}function E(n){if(void 0===n||!n.lengthComputable)return;let o=Math.floor(100*n.loaded/n.total);e.onUploadProgress&&e.onUploadProgress.call(this,o),o>=100&&e.onUploadComplete&&e.onUploadComplete.call()}return e.data||(e.data={}),e.headers||(e.headers={}),e.max_files||(e.max_files=1),e.timeout||(e.timeout=0),e.max_files_size||(e.max_files_size=20971520),e.kill_document_dad||(e.kill_document_dad=!1),e.onDragEnter||(e.onDragEnter=null),e.onDragLeave||(e.onDragLeave=null),e.onNewFiles||(e.onNewFiles=null),e.onFileSizeError||(e.onFileSizeError=null),e.onTooManyFiles||(e.onTooManyFiles=null),e.onBeforeUpload||(e.onBeforeUpload=null),e.onUploadProgress||(e.onUploadProgress=null),e.onUploadComplete||(e.onUploadComplete=null),e.onUploadSuccess||(e.onUploadSuccess=null),e.onUploadError||(e.onUploadError=null),e.onAjaxComplete||(e.onAjaxComplete=null),e.max_files>1?r.setAttribute('multiple',''):r.removeAttribute('multiple'),t.addEventListener('click',d),r.addEventListener('change',s),t.addEventListener('drop',i),t.addEventListener('dragenter',c),t.addEventListener('dragover',u),t.addEventListener('dragleave',p),e.kill_document_dad&&(document.addEventListener('drag',f),document.addEventListener('dragstart',f),document.addEventListener('dragend',f),document.addEventListener('dragenter',f),document.addEventListener('dragover',f),document.addEventListener('dragleave',f),document.addEventListener('drop',f)),{opt:e,upload_in_progress:l,cancel:function(){l=!1,v()},destroy:function(){t.removeEventListener('click',d),r.removeEventListener('change',s),t.removeEventListener('drop',i),t.removeEventListener('dragenter',c),t.removeEventListener('dragover',u),t.removeEventListener('dragleave',p),e.kill_document_dad&&(document.removeEventListener('drag',f),document.removeEventListener('dragstart',f),document.removeEventListener('dragend',f),document.removeEventListener('dragenter',f),document.removeEventListener('dragover',f),document.removeEventListener('dragleave',f),document.removeEventListener('drop',f)),v()}}};
